{"title":"day04-部门管理模块","uid":"bb1b312f3480359373d075dad12e4c2e","slug":"springboot-vue-wx-project/day04-部门管理模块","date":"2022-07-11T03:31:26.000Z","updated":"2022-07-11T10:59:52.366Z","comments":true,"path":"api/articles/springboot-vue-wx-project/day04-部门管理模块.json","keywords":"Java study learn 学习","cover":null,"content":"<p>部门管理模块</p>\n<span id=\"more\"></span>\n\n<h1 id=\"查询\"><a href=\"#查询\" class=\"headerlink\" title=\"查询\"></a>查询</h1><h2 id=\"前端\"><a href=\"#前端\" class=\"headerlink\" title=\"前端\"></a>前端</h2><h3 id=\"dept-vue\"><a href=\"#dept-vue\" class=\"headerlink\" title=\"dept.vue\"></a>dept.vue</h3><h4 id=\"Template\"><a href=\"#Template\" class=\"headerlink\" title=\"Template\"></a>Template</h4><pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">v-model&#x3D;&quot;dataForm.deptName&quot;\n&lt;el-button size&#x3D;&quot;medium&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;searchHandle()&quot;&gt;查询&lt;&#x2F;el-button&gt;</code></pre>\n\n<h4 id=\"Script\"><a href=\"#Script\" class=\"headerlink\" title=\"Script\"></a>Script</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">searchHandle:function ()&#123;\n\t\t\tlet that&#x3D;this;\n\t\t\tthat.$refs[&#39;dataForm&#39;].validate(valid&#x3D;&gt;&#123;\n\t\t\t\tif(valid)&#123;\n\t\t\t\t\tthat.$refs[&#39;dataForm&#39;].clearValidate();\n\t\t\t\t\tif(that.dataForm.deptName&#x3D;&#x3D;&#39;&#39;)&#123;\n\t\t\t\t\t\tthat.dataForm.deptName&#x3D;null;\n\t\t\t\t\t&#125;\n\t\t\t\t\tif(that.dataForm.pageIndex!&#x3D;1)&#123;\n\t\t\t\t\t\tthat.pageIndex&#x3D;1;\n\t\t\t\t\t&#125;\n\t\t\t\t\tthat.loadDateList();\n\t\t\t\t&#125;else&#123;\n\t\t\t\t\treturn false;\n\t\t\t\t&#125;\n\t\t\t&#125;)\n\t\t&#125;,\n\t\tloadDateList: function()&#123;\n\t\t\tlet that &#x3D; this;\n\t\t\tthat.dataListLoading&#x3D;true;\n\t\t\tlet data&#x3D;&#123;\n\t\t\t\tdeptName: that.dataForm.deptName,\n\t\t\t\tpage: that.pageIndex,\n\t\t\t\tlength: that.pageSize\n\t\t\t&#125;;\n\t\t\tthat.$http(&#39;dept&#x2F;searchDeptByPage&#39;,&#39;POST&#39;,data,true,function(resp)&#123;\n\t\t\t\tlet page&#x3D;resp.page;\n\t\t\t\tthat.dataList&#x3D;page.list;\n\t\t\t\tthat.totalCount&#x3D;page.totalCount;\n\t\t\t\tthat.dataListLoading&#x3D;false;\n\t\t\t&#125;)\n\t\t&#125;</code></pre>\n\n<h2 id=\"后端\"><a href=\"#后端\" class=\"headerlink\" title=\"后端\"></a>后端</h2><h3 id=\"DAO\"><a href=\"#DAO\" class=\"headerlink\" title=\"DAO\"></a>DAO</h3><h4 id=\"TbDeptDao\"><a href=\"#TbDeptDao\" class=\"headerlink\" title=\"TbDeptDao\"></a>TbDeptDao</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">public long searchDeptCount(HashMap param);\npublic ArrayList&lt;HashMap&gt; searchDeptByPage(HashMap param);</code></pre>\n\n<h4 id=\"Mapper\"><a href=\"#Mapper\" class=\"headerlink\" title=\"Mapper:\"></a>Mapper:</h4><p>在TbDeptDao,xml文件中，定义SQL用于查询部门分页数据。在部门管理页面上，只有按照部门名字模糊查询。所以在SQL语句中，WHERE子句里面只有一个查询条件。由于在页面表格中要显示每个部门拥有的员工数量，所以用了COUNT（）汇总函数。</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">&lt;select id&#x3D;&quot;searchDeptCount&quot; parameterType&#x3D;&quot;HashMap&quot; resultType&#x3D;&quot;long&quot;&gt;\n      SELECT count(*)\n      FROM (\n      SELECT d.id\n      FROM tb_dept d LEFT JOIN tb_user u ON u.dept_id&#x3D;d.id AND u.status&#x3D;1\n      &lt;where&gt;\n        &lt;if test&#x3D;&quot;deptName!&#x3D;null&quot;&gt;\n          d.dept_name like &#39;%$&#123;deptName&#125;%&#39;\n        &lt;&#x2F;if&gt;\n      &lt;&#x2F;where&gt;\n      GROUP BY d.id\n      ) as temp\n&lt;&#x2F;select&gt;\n&lt;select id&#x3D;&quot;searchDeptByPage&quot; parameterType&#x3D;&quot;HashMap&quot; resultType&#x3D;&quot;HashMap&quot;&gt;\n  SELECT d.id,\n         d.dept_name AS deptName,\n         d.tel,\n         d.email,\n         count(u.id) as emps,\n         d.&#96;desc&#96;\n  FROM tb_dept d\n  LEFT JOIN tb_user u ON u.dept_id&#x3D;d.id AND u.status&#x3D;1\n  &lt;where&gt;\n    &lt;if test&#x3D;&quot;deptName!&#x3D;null&quot;&gt;\n      d.dept_name like &#39;%$&#123;deptName&#125;%&#39;\n    &lt;&#x2F;if&gt;\n  &lt;&#x2F;where&gt;\n  GROUP BY d.id\n  LIMIT #&#123;start&#125;,#&#123;length&#125;\n&lt;&#x2F;select&gt;</code></pre>\n\n<h3 id=\"Service\"><a href=\"#Service\" class=\"headerlink\" title=\"Service\"></a>Service</h3><h4 id=\"DeptService\"><a href=\"#DeptService\" class=\"headerlink\" title=\"DeptService\"></a>DeptService</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">public PageUtils searchDeptByPage(HashMap param);</code></pre>\n\n<h4 id=\"Impl\"><a href=\"#Impl\" class=\"headerlink\" title=\"Impl\"></a>Impl</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Override\npublic PageUtils searchDeptByPage(HashMap param) &#123;\n    ArrayList&lt;HashMap&gt; list &#x3D; deptDao.searchDeptByPage(param);\n    Integer start &#x3D; (Integer) param.get(&quot;start&quot;);\n    Integer length&#x3D;(Integer) param.get(&quot;length&quot;);\n    long count &#x3D; deptDao.searchDeptCount(param);\n    return new PageUtils(list,count,start,length);\n&#125;</code></pre>\n\n<h3 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"Controller\"></a>Controller</h3><h4 id=\"SearchDeptByPageForm\"><a href=\"#SearchDeptByPageForm\" class=\"headerlink\" title=\"SearchDeptByPageForm\"></a>SearchDeptByPageForm</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Data\n@Schema(description &#x3D; &quot;查询部门分页表单&quot;)\npublic class SearchDeptByPageForm &#123;\n\n    @NotNull(message &#x3D; &quot;page不能为空&quot;)\n    @Min(value &#x3D; 1,message &#x3D; &quot;页数不能小于1&quot;)\n    @Schema(description &#x3D; &quot;页数&quot;)\n    private Integer page;\n\n    @NotNull(message &#x3D; &quot;length不能为空&quot;)\n    @Range(min &#x3D; 10,max &#x3D; 50,message &#x3D; &quot;length必须在10-50之间&quot;)\n    @Schema(description &#x3D; &quot;每页记录数&quot;)\n    private Integer length;\n\n    @Pattern(regexp &#x3D; &quot;^[a-zA-Z0-9\\\\u4e00-\\\\u9fa5]&#123;1,10&#125;$&quot;,message &#x3D; &quot;角色名称不正确&quot;)\n    @Schema(description &#x3D; &quot;角色名称&quot;)\n    private String deptName;\n&#125;</code></pre>\n\n<h4 id=\"DeptController\"><a href=\"#DeptController\" class=\"headerlink\" title=\"DeptController\"></a>DeptController</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@PostMapping(&quot;&#x2F;searchDeptByPage&quot;)\n@Operation(summary &#x3D; &quot;根据部门名称查询部门&quot;)\n@SaCheckPermission(value &#x3D; &#123;&quot;ROOT&quot;, &quot;DEPT:SELECT&quot;&#125;, mode &#x3D; SaMode.OR)\npublic R searchDeptByPage(@Valid @RequestBody SearchDeptByPageForm form)&#123;\n    int page &#x3D; form.getPage();\n    int length&#x3D;form.getLength();\n    int start&#x3D;(page-1)*length;\n    HashMap param &#x3D; JSONUtil.parse(form).toBean(HashMap.class);\n    param.put(&quot;start&quot;,start);\n    PageUtils pageUtils &#x3D; deptService.searchDeptByPage(param);\n    return R.ok().put(&quot;page&quot;,pageUtils);\n&#125;</code></pre>\n\n<h1 id=\"新增-x2F-修改\"><a href=\"#新增-x2F-修改\" class=\"headerlink\" title=\"新增&#x2F;修改\"></a>新增&#x2F;修改</h1><h2 id=\"前端-1\"><a href=\"#前端-1\" class=\"headerlink\" title=\"前端\"></a>前端</h2><h3 id=\"dept-vue-1\"><a href=\"#dept-vue-1\" class=\"headerlink\" title=\"dept.vue\"></a>dept.vue</h3><h4 id=\"Template-1\"><a href=\"#Template-1\" class=\"headerlink\" title=\"Template\"></a>Template</h4><pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">&lt;el-button size&#x3D;&quot;medium&quot; type&#x3D;&quot;primary&quot; :disabled&#x3D;&quot;!isAuth([&#39;ROOT&#39;, &#39;DEPT:INSERT&#39;])&quot; @click&#x3D;&quot;addHandle()&quot;&gt;\n\t\t\t\t\t新增\n&lt;&#x2F;el-button&gt;\n&lt;el-button type&#x3D;&quot;text&quot; size&#x3D;&quot;medium&quot; :disabled&#x3D;&quot;!isAuth([&#39;ROOT&#39;, &#39;DEPT:UPDATE&#39;])&quot; @click&#x3D;&quot;updateHandle(scope.row.id)&quot;&gt;\n\t\t\t\t\t\t修改\n&lt;&#x2F;el-button&gt;</code></pre>\n\n<h4 id=\"Script-1\"><a href=\"#Script-1\" class=\"headerlink\" title=\"Script\"></a>Script</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">addHandle: function()&#123;\n\t\tthis.addOrUpdateVisible&#x3D;true;\n\t\tthis.$nextTick(()&#x3D;&gt;&#123;\n\t\t\tthis.$refs.addOrUpdate.init();\n\t\t&#125;)\n\t&#125;,\n\tupdateHandle: function(id)&#123;\n\t\tthis.addOrUpdateVisible&#x3D;true;\n\t\tthis.$nextTick(()&#x3D;&gt;&#123;\n\t\t\tthis.$refs.addOrUpdate.init(id);\n\t\t&#125;)\n\t&#125;</code></pre>\n\n<h3 id=\"dept-add-or-update-vue\"><a href=\"#dept-add-or-update-vue\" class=\"headerlink\" title=\"dept-add-or-update.vue\"></a>dept-add-or-update.vue</h3><h4 id=\"Template-2\"><a href=\"#Template-2\" class=\"headerlink\" title=\"Template\"></a>Template</h4><pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">v-model&#x3D;&quot;dataForm.deptName&quot;\nv-model&#x3D;&quot;dataForm.tel&quot;\nv-model&#x3D;&quot;dataForm.email&quot;\nv-model&#x3D;&quot;dataForm.desc&quot;\n&lt;el-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;medium&quot; @click&#x3D;&quot;dataFormSubmit&quot;&gt;确定&lt;&#x2F;el-button&gt;</code></pre>\n\n<h4 id=\"Script-2\"><a href=\"#Script-2\" class=\"headerlink\" title=\"Script\"></a>Script</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">init: function(id) &#123;\n\t\t\tlet that &#x3D; this;\n\t\t\tthat.dataForm.id &#x3D; id || 0;\n\t\t\tthat.visible &#x3D; true;\n\t\t\tthat.$nextTick(() &#x3D;&gt; &#123;\n\t\t\t\tthat.$refs[&#39;dataForm&#39;].resetFields();\n\t\t\t\tif (id) &#123;\n\t\t\t\t\tthat.$http(&#39;dept&#x2F;searchById&#39;, &#39;POST&#39;, &#123; id: id &#125;,true, function(resp) &#123;\n\t\t\t\t\t\tthat.dataForm.deptName &#x3D; resp.deptName;\n\t\t\t\t\t\tthat.dataForm.tel &#x3D; resp.tel;\n\t\t\t\t\t\tthat.dataForm.email &#x3D; resp.email;\n\t\t\t\t\t\tthat.dataForm.desc &#x3D; resp.desc;\n\t\t\t\t\t&#125;);\n\t\t\t\t&#125;\n\t\t\t&#125;);\n\t\t&#125;,\n\t\tdataFormSubmit: function()&#123;\n\t\t\tlet that &#x3D; this;\n\t\t\tthat.$refs[&#39;dataForm&#39;].validate(valid&#x3D;&gt;&#123;\n\t\t\t\tif(valid)&#123;\n\t\t\t\t\tthat.$http(&#96;dept&#x2F;$&#123;!that.dataForm.id?&#39;insert&#39;:&#39;update&#39;&#125;&#96;,&#39;POST&#39;,that.dataForm,true,function(resp)&#123;\n\t\t\t\t\t\tif (resp.rows &#x3D;&#x3D; 1) &#123;\n\t\t\t\t\t\t\tthat.$message(&#123;\n\t\t\t\t\t\t\t\tmessage: &#39;操作成功&#39;,\n\t\t\t\t\t\t\t\ttype: &#39;success&#39;,\n\t\t\t\t\t\t\t\tduration: 1200\n\t\t\t\t\t\t\t&#125;)\n\t\t\t\t\t\t\tthat.visible &#x3D; false;\n\t\t\t\t\t\t\tthat.$parent.loadDateList();\n\t\t\t\t\t\t\tthat.$emit(&#39;refreshDataList&#39;);\n\t\t\t\t\t\t&#125; else &#123;\n\t\t\t\t\t\t\tthat.$message(&#123;\n\t\t\t\t\t\t\t\tmessage: &#39;操作失败&#39;,\n\t\t\t\t\t\t\t\ttype: &#39;error&#39;,\n\t\t\t\t\t\t\t\tduration: 1200\n\t\t\t\t\t\t\t&#125;)\n\t\t\t\t\t\t&#125;\n\t\t\t\t\t&#125;)\n\t\t\t\t&#125;\n\t\t\t&#125;)\n\t\t&#125;</code></pre>\n\n<h2 id=\"后端-1\"><a href=\"#后端-1\" class=\"headerlink\" title=\"后端\"></a>后端</h2><h3 id=\"DAO-1\"><a href=\"#DAO-1\" class=\"headerlink\" title=\"DAO\"></a>DAO</h3><h4 id=\"TbDeptDao-1\"><a href=\"#TbDeptDao-1\" class=\"headerlink\" title=\"TbDeptDao\"></a>TbDeptDao</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">public int insert(TbDept tbDept);\n\npublic int update(TbDept dept);</code></pre>\n\n<h4 id=\"Mapper-1\"><a href=\"#Mapper-1\" class=\"headerlink\" title=\"Mapper\"></a>Mapper</h4><pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;insert id&#x3D;&quot;insert&quot;&gt;\n  INSERT INTO tb_dept\n  &lt;set&gt;\n    dept_name &#x3D;#&#123;deptName&#125;\n      &lt;if test&#x3D;&quot;desc!&#x3D;null&quot;&gt;\n        ,&#96;desc&#96;&#x3D;#&#123;desc&#125;\n      &lt;&#x2F;if&gt;\n      &lt;if test&#x3D;&quot;tel!&#x3D;null&quot;&gt;\n        ,tel&#x3D;#&#123;tel&#125;\n      &lt;&#x2F;if&gt;\n      &lt;if test&#x3D;&quot;email!&#x3D;null&quot;&gt;\n       , email&#x3D;#&#123;email&#125;\n      &lt;&#x2F;if&gt;\n  &lt;&#x2F;set&gt;\n&lt;&#x2F;insert&gt;\n&lt;update id&#x3D;&quot;update&quot;&gt;\n  UPDATE tb_dept\n  &lt;set&gt;\n    dept_name &#x3D;#&#123;deptName&#125;,\n    &#96;desc&#96;&#x3D;#&#123;desc&#125;,\n     tel&#x3D;#&#123;tel&#125;,\n     email&#x3D;#&#123;email&#125;\n  &lt;&#x2F;set&gt;\n  WHERE id&#x3D;#&#123;id&#125;\n&lt;&#x2F;update&gt;</code></pre>\n\n<h3 id=\"Service-1\"><a href=\"#Service-1\" class=\"headerlink\" title=\"Service\"></a>Service</h3><h4 id=\"DeptService-1\"><a href=\"#DeptService-1\" class=\"headerlink\" title=\"DeptService\"></a>DeptService</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">public int insert(TbDept tbDept);\n\npublic int update(TbDept dept);</code></pre>\n\n<h4 id=\"Impl-1\"><a href=\"#Impl-1\" class=\"headerlink\" title=\"Impl\"></a>Impl</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Override\npublic int insert(TbDept tbDept) &#123;\n    return deptDao.insert(tbDept);\n&#125;\n\n@Override\npublic int update(TbDept dept) &#123;\n    return deptDao.update(dept);\n&#125;</code></pre>\n\n<h3 id=\"Controller-1\"><a href=\"#Controller-1\" class=\"headerlink\" title=\"Controller\"></a>Controller</h3><h4 id=\"UpdateDeptForm\"><a href=\"#UpdateDeptForm\" class=\"headerlink\" title=\"UpdateDeptForm\"></a>UpdateDeptForm</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Data\n@Schema(description &#x3D; &quot;修改部门表单&quot;)\npublic class UpdateDeptForm &#123;\n\n    @NotNull(message &#x3D; &quot;id不难为空&quot;)\n    @Schema(description &#x3D; &quot;部门ID&quot;)\n    private Integer id;\n\n    @NotBlank(message &#x3D; &quot;deptName不能为空&quot;)\n    @Pattern(regexp &#x3D; &quot;^[a-zA-Z0-9\\\\u4e00-\\\\u9fa5]&#123;2,10&#125;$&quot;,message &#x3D; &quot;deptName格式不正确&quot;)\n    @Schema(description &#x3D; &quot;部门名称&quot;)\n    private String deptName;\n\n\n    @Email(message &#x3D; &quot;email格式不正确&quot;)\n    @Schema(description &#x3D; &quot;邮箱&quot;)\n    private String email;\n\n    @Pattern(regexp &#x3D; &quot;^1\\\\d&#123;10&#125;$|^(0\\\\d&#123;2,3&#125;-)?[1-9]\\\\d&#123;6,7&#125;$&quot;,message &#x3D; &quot;tel格式不正确&quot;)\n    @Schema(description &#x3D; &quot;电话&quot;)\n    private String tel;\n\n    @Length(max &#x3D; 20,message &#x3D; &quot;desc不能超过20个&quot;)\n    @Schema(description &#x3D; &quot;备注&quot;)\n    private String desc;\n&#125;</code></pre>\n\n<h4 id=\"InsertDeptForm\"><a href=\"#InsertDeptForm\" class=\"headerlink\" title=\"InsertDeptForm\"></a>InsertDeptForm</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Data\n@Schema(description &#x3D; &quot;新增部门&quot;)\npublic class InsertDeptForm &#123;\n\n    @NotBlank(message &#x3D; &quot;deptName不能为空&quot;)\n    @Pattern(regexp &#x3D; &quot;^[a-zA-Z0-9\\\\u4e00-\\\\u9fa5]&#123;2,10&#125;$&quot;,message &#x3D; &quot;deptName格式不正确&quot;)\n    @Schema(description &#x3D; &quot;部门名称&quot;)\n    private String deptName;\n\n\n    @Email(message &#x3D; &quot;email格式不正确&quot;)\n    @Schema(description &#x3D; &quot;邮箱&quot;)\n    private String email;\n\n\n    @Pattern(regexp &#x3D; &quot;^\\\\d&#123;10&#125;$&quot;,message &#x3D; &quot;tel格式不正确&quot;)\n    @Schema(description &#x3D; &quot;电话&quot;)\n    private String tel;\n\n    @Length(max &#x3D; 20,message &#x3D; &quot;desc不能超过20个&quot;)\n    @Schema(description &#x3D; &quot;备注&quot;)\n    private String desc;\n\n&#125;</code></pre>\n\n<h4 id=\"DeptController-1\"><a href=\"#DeptController-1\" class=\"headerlink\" title=\"DeptController\"></a>DeptController</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@PostMapping(&quot;&#x2F;insert&quot;)\n@Operation(summary &#x3D; &quot;新增部门&quot;)\n@SaCheckPermission(value &#x3D; &#123;&quot;ROOT&quot;, &quot;DEPT:INSERT&quot;&#125;, mode &#x3D; SaMode.OR)\npublic R insert(@Valid @RequestBody InsertDeptForm form)&#123;\n    TbDept tbDept&#x3D;new TbDept();\n    tbDept.setDeptName(form.getDeptName());\n    tbDept.setDesc(form.getDesc());\n    tbDept.setEmail(form.getEmail());\n    tbDept.setTel(form.getTel());\n    int rows &#x3D; deptService.insert(tbDept);\n    return R.ok().put(&quot;rows&quot;,rows);\n&#125;\n\n@PostMapping(&quot;&#x2F;update&quot;)\n@Operation(summary &#x3D; &quot;修改部门信息&quot;)\n@SaCheckPermission(value &#x3D; &#123;&quot;ROOT&quot;,&quot;DEPT:UPDATE&quot;&#125;,mode &#x3D; SaMode.OR)\npublic R update(@Valid @RequestBody UpdateDeptForm form)&#123;\n    TbDept tbDept&#x3D;new TbDept();\n    tbDept.setDeptName(form.getDeptName());\n    tbDept.setDesc(form.getDesc());\n    tbDept.setEmail(form.getEmail());\n    tbDept.setTel(form.getTel());\n    tbDept.setId(form.getId());\n    int rows &#x3D; deptService.update(tbDept);\n    return R.ok().put(&quot;rows&quot;,rows);\n&#125;</code></pre>\n\n<h1 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h1><h2 id=\"前端-2\"><a href=\"#前端-2\" class=\"headerlink\" title=\"前端\"></a>前端</h2><h3 id=\"dept-vue-2\"><a href=\"#dept-vue-2\" class=\"headerlink\" title=\"dept.vue\"></a>dept.vue</h3><h4 id=\"Template-3\"><a href=\"#Template-3\" class=\"headerlink\" title=\"Template\"></a>Template</h4><pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">&lt;el-button size&#x3D;&quot;medium&quot; type&#x3D;&quot;danger&quot; :disabled&#x3D;&quot;!isAuth([&#39;ROOT&#39;, &#39;DEPT:DELETE&#39;])&quot; @click&#x3D;&quot;deleteHandle()&quot;&gt;\n\t\t\t\t\t批量删除\n&lt;&#x2F;el-button&gt;\n\n&lt;el-button type&#x3D;&quot;text&quot; size&#x3D;&quot;medium&quot; :disabled&#x3D;&quot;!isAuth([&#39;ROOT&#39;, &#39;DEPT:DELETE&#39;]) || scope.row.emps&gt; 0&quot; @click&#x3D;&quot;deleteHandle(scope.row.id)&quot;&gt;\n\t\t\t\t\t\t删除\n&lt;&#x2F;el-button&gt;</code></pre>\n\n<h4 id=\"Script-3\"><a href=\"#Script-3\" class=\"headerlink\" title=\"Script\"></a>Script</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">selectionChangeHandle: function(val) &#123;\n\tthis.dataListSelections &#x3D; val;\n&#125;,\ndeleteHandle: function(id) &#123;\n\tlet that &#x3D; this;\n\tlet ids &#x3D; id ? [id] : that.dataListSelections.map(item &#x3D;&gt; &#123;\n\t\t\treturn item.id\n\t&#125;);\n\tif (ids &#x3D;&#x3D; 0) &#123;\n\t\tthat.$message(&#123;\n\t\t\tmessage: &#39;没有选中记录&#39;,\n\t\t\ttype: &#39;warning&#39;,\n\t\t\tduration: 1200\n\t\t&#125;);\n\t&#125; else &#123;\n\t\tthat.$confirm(&#96;确定要删除选中的记录吗？&#96;, &#39;提示&#39;, &#123;\n\t\t\tconfirmButtonText: &#39;确定&#39;,\n\t\t\tcancelButtonText: &#39;取消&#39;,\n\t\t\ttype: &#39;warning&#39;\n\t\t&#125;).then(() &#x3D;&gt; &#123;\n\t\t\tthat.$http(&#39;dept&#x2F;deleteDeptByIds&#39;, &#39;POST&#39;, &#123;\n\t\t\t\tids: ids\n\t\t\t&#125;, true, function(resp) &#123;\n\t\t\t\tif (resp.rows &gt; 0) &#123;\n\t\t\t\t\tthat.$message(&#123;\n\t\t\t\t\t\tmessage: &#39;操作成功&#39;,\n\t\t\t\t\t\ttype: &#39;success&#39;,\n\t\t\t\t\t\tduration: 1200\n\t\t\t\t\t&#125;);\n\t\t\t\t\tthat.loadDateList();\n\t\t\t\t&#125; else &#123;\n\t\t\t\t\tthat.$message(&#123;\n\t\t\t\t\t\tmessage: &#39;删除失败&#39;,\n\t\t\t\t\t\ttype: &#39;warning&#39;,\n\t\t\t\t\t\tduration: 1200\n\t\t\t\t\t&#125;);\n\t\t\t\t&#125;\n\t\t\t&#125;);\n\t\t&#125;);\n\t&#125;\n&#125;</code></pre>\n\n<h2 id=\"后端-2\"><a href=\"#后端-2\" class=\"headerlink\" title=\"后端\"></a>后端</h2><h3 id=\"DAO-2\"><a href=\"#DAO-2\" class=\"headerlink\" title=\"DAO\"></a>DAO</h3><h4 id=\"DeptDao\"><a href=\"#DeptDao\" class=\"headerlink\" title=\"DeptDao\"></a>DeptDao</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">public boolean searchCanDelete(Integer[] ids);\n\npublic int deleteDeptByIds(Integer[] ids);</code></pre>\n\n<h4 id=\"Mapper-2\"><a href=\"#Mapper-2\" class=\"headerlink\" title=\"Mapper\"></a>Mapper</h4><pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;select id&#x3D;&quot;searchDeptCount&quot; parameterType&#x3D;&quot;HashMap&quot; resultType&#x3D;&quot;long&quot;&gt;\n      SELECT count(*)\n      FROM (\n      SELECT d.id\n      FROM tb_dept d LEFT JOIN tb_user u ON u.dept_id&#x3D;d.id AND u.status&#x3D;1\n      &lt;where&gt;\n        &lt;if test&#x3D;&quot;deptName!&#x3D;null&quot;&gt;\n          d.dept_name like &#39;%$&#123;deptName&#125;%&#39;\n        &lt;&#x2F;if&gt;\n      &lt;&#x2F;where&gt;\n      GROUP BY d.id\n      ) as temp\n&lt;&#x2F;select&gt;\n&lt;delete id&#x3D;&quot;deleteDeptByIds&quot;&gt;\n    DELETE FROM tb_dept\n    where id IN\n    &lt;foreach collection&#x3D;&quot;array&quot; open&#x3D;&quot;(&quot; separator&#x3D;&quot;,&quot; close&#x3D;&quot;)&quot; item&#x3D;&quot;one&quot;&gt;\n      #&#123;one&#125;\n    &lt;&#x2F;foreach&gt;\n  &lt;&#x2F;delete&gt;</code></pre>\n\n<h3 id=\"Service-2\"><a href=\"#Service-2\" class=\"headerlink\" title=\"Service\"></a>Service</h3><h4 id=\"DeptService-2\"><a href=\"#DeptService-2\" class=\"headerlink\" title=\"DeptService\"></a>DeptService</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">public int deleteDeptByIds(Integer[] ids) throws Exception;</code></pre>\n\n<h4 id=\"Impl-2\"><a href=\"#Impl-2\" class=\"headerlink\" title=\"Impl\"></a>Impl</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Override\npublic int deleteDeptByIds(Integer[] ids)&#123;\n    boolean flag &#x3D; deptDao.searchCanDelete(ids);\n    if (!flag)&#123;\n        throw new EmosException(&quot;无法删除关联用户的部门&quot;);\n    &#125;\n    return deptDao.deleteDeptByIds(ids);\n&#125;</code></pre>\n\n<h3 id=\"Controller-2\"><a href=\"#Controller-2\" class=\"headerlink\" title=\"Controller\"></a>Controller</h3><h4 id=\"DeleteDeptByIdsForm\"><a href=\"#DeleteDeptByIdsForm\" class=\"headerlink\" title=\"DeleteDeptByIdsForm\"></a>DeleteDeptByIdsForm</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Data\n@Schema(description &#x3D; &quot;删除部门表单&quot;)\npublic class DeleteDeptByIdsForm &#123;\n\n    @NotEmpty(message &#x3D; &quot;ids不能为空&quot;)\n    @Schema(description &#x3D; &quot;角色ID&quot;)\n    private Integer[] ids;\n&#125;</code></pre>\n\n<h4 id=\"DeptController-2\"><a href=\"#DeptController-2\" class=\"headerlink\" title=\"DeptController\"></a>DeptController</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@PostMapping(&quot;&#x2F;deleteDeptByIds&quot;)\n@Operation(summary &#x3D; &quot;删除部门信息&quot;)\n@SaCheckPermission(value &#x3D; &#123;&quot;ROOT&quot;,&quot;DEPT:DELETE&quot;&#125;,mode &#x3D; SaMode.OR)\npublic R deleteDeptByIds(@Valid @RequestBody DeleteDeptByIdsForm form) throws Exception &#123;\n    int rows &#x3D; deptService.deleteDeptByIds(form.getIds());\n    return R.ok().put(&quot;rows&quot;,rows);\n&#125;</code></pre>\n","feature":true,"text":"部门管理模块 查询前端dept.vueTemplatev-model&#x3D;&quot;dataForm.deptName&quot; &lt;el-button size&#x3D;&quot;medium&quot; type&#x3D;&quot;primary&quo...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"13 mins."},"categories":[{"name":"Java","slug":"Java","count":5,"path":"api/categories/Java.json"},{"name":"Vue","slug":"Java/Vue","count":4,"path":"api/categories/Java/Vue.json"}],"tags":[{"name":"springboot","slug":"springboot","count":4,"path":"api/tags/springboot.json"},{"name":"vue","slug":"vue","count":4,"path":"api/tags/vue.json"},{"name":"wx","slug":"wx","count":4,"path":"api/tags/wx.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">查询</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%AB%AF\"><span class=\"toc-text\">前端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#dept-vue\"><span class=\"toc-text\">dept.vue</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Template\"><span class=\"toc-text\">Template</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Script\"><span class=\"toc-text\">Script</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%AB%AF\"><span class=\"toc-text\">后端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DAO\"><span class=\"toc-text\">DAO</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#TbDeptDao\"><span class=\"toc-text\">TbDeptDao</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Mapper\"><span class=\"toc-text\">Mapper:</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Service\"><span class=\"toc-text\">Service</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeptService\"><span class=\"toc-text\">DeptService</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Impl\"><span class=\"toc-text\">Impl</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Controller\"><span class=\"toc-text\">Controller</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#SearchDeptByPageForm\"><span class=\"toc-text\">SearchDeptByPageForm</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeptController\"><span class=\"toc-text\">DeptController</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%96%B0%E5%A2%9E-x2F-%E4%BF%AE%E6%94%B9\"><span class=\"toc-text\">新增&#x2F;修改</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%AB%AF-1\"><span class=\"toc-text\">前端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#dept-vue-1\"><span class=\"toc-text\">dept.vue</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Template-1\"><span class=\"toc-text\">Template</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Script-1\"><span class=\"toc-text\">Script</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#dept-add-or-update-vue\"><span class=\"toc-text\">dept-add-or-update.vue</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Template-2\"><span class=\"toc-text\">Template</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Script-2\"><span class=\"toc-text\">Script</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%AB%AF-1\"><span class=\"toc-text\">后端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DAO-1\"><span class=\"toc-text\">DAO</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#TbDeptDao-1\"><span class=\"toc-text\">TbDeptDao</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Mapper-1\"><span class=\"toc-text\">Mapper</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Service-1\"><span class=\"toc-text\">Service</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeptService-1\"><span class=\"toc-text\">DeptService</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Impl-1\"><span class=\"toc-text\">Impl</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Controller-1\"><span class=\"toc-text\">Controller</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#UpdateDeptForm\"><span class=\"toc-text\">UpdateDeptForm</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#InsertDeptForm\"><span class=\"toc-text\">InsertDeptForm</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeptController-1\"><span class=\"toc-text\">DeptController</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4\"><span class=\"toc-text\">删除</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%AB%AF-2\"><span class=\"toc-text\">前端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#dept-vue-2\"><span class=\"toc-text\">dept.vue</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Template-3\"><span class=\"toc-text\">Template</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Script-3\"><span class=\"toc-text\">Script</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%AB%AF-2\"><span class=\"toc-text\">后端</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DAO-2\"><span class=\"toc-text\">DAO</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeptDao\"><span class=\"toc-text\">DeptDao</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Mapper-2\"><span class=\"toc-text\">Mapper</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Service-2\"><span class=\"toc-text\">Service</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeptService-2\"><span class=\"toc-text\">DeptService</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Impl-2\"><span class=\"toc-text\">Impl</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Controller-2\"><span class=\"toc-text\">Controller</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeleteDeptByIdsForm\"><span class=\"toc-text\">DeleteDeptByIdsForm</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DeptController-2\"><span class=\"toc-text\">DeptController</span></a></li></ol></li></ol></li></ol></li></ol>","author":{"name":"星桜","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"学习Java中","socials":{"github":"https://github.com/umrlll","twitter":"https://twitter.com/Smile_Amber234","stackoverflow":"","wechat":"","qq":"tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1414018493&website=www.oicqzone.com","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/24956413"}}}},"mapped":true,"prev_post":{},"next_post":{"title":"day03-角色管理模块","uid":"79eff727357b876604bb9d3e662b11e2","slug":"springboot-vue-wx-project/day03-角色管理模块","date":"2022-07-11T03:30:31.000Z","updated":"2022-07-11T07:51:37.542Z","comments":true,"path":"api/articles/springboot-vue-wx-project/day03-角色管理模块.json","keywords":"Java study learn 学习","cover":null,"text":"角色管理模块 查询前端：role.vueTemplate v-model&#x3D;&quot;dataForm.roleName&quot; &lt;el-button size&#x3D;&quot;medium&quot; type&#x3D;&quot;primary&q...","link":"","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"Java","slug":"Java","count":5,"path":"api/categories/Java.json"},{"name":"Vue","slug":"Java/Vue","count":4,"path":"api/categories/Java/Vue.json"}],"tags":[{"name":"springboot","slug":"springboot","count":4,"path":"api/tags/springboot.json"},{"name":"vue","slug":"vue","count":4,"path":"api/tags/vue.json"},{"name":"wx","slug":"wx","count":4,"path":"api/tags/wx.json"}],"author":{"name":"星桜","slug":"blog-author","avatar":"/images/avatar.png","link":"/","description":"学习Java中","socials":{"github":"https://github.com/umrlll","twitter":"https://twitter.com/Smile_Amber234","stackoverflow":"","wechat":"","qq":"tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1414018493&website=www.oicqzone.com","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://space.bilibili.com/24956413"}}}},"feature":true}}